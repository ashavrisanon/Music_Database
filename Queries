SELECT title, first_name, last_name
FROM employee 
ORDER BY levels DESC
LIMIT 1


SELECT billing_country, COUNT(*)
FROM invoice
GROUP BY billing_country
ORDER BY billing_country DESC
LIMIT 1


SELECT total
FROM invoice
ORDER BY total DESC
LIMIT 3


SELECT billing_city, SUM(total) AS total_invoice
FROM invoice
GROUP BY billing_city
ORDER BY SUM(total) DESC
LIMIT 1


SELECT c.first_name, c.last_name, c.customer_id, SUM(i.total) AS total_spending
FROM invoice i join customer c on i.customer_id = c.customer_id
GROUP BY c.first_name, c.last_name, c.customer_id
ORDER BY SUM(i.total) DESC
LIMIT 1

SELECT r.artist_id, r.name, COUNT(r.artist_id)
FROM (( genre g JOIN track t ON g.genre_id = t.genre_id)
JOIN album a ON a.album_id = t.album_id)
JOIN artist r ON r.artist_id = a.artist_id
WHERE g.name = 'Rock'
GROUP BY r.artist_id, r.name
ORDER BY COUNT(r.artist_id) DESC
LIMIT 10


SELECT name, milliseconds
FROM track
WHERE milliseconds > (SELECT AVG(milliseconds) FROM track)
ORDER BY milliseconds DESC


WITH best_selling_artist AS 
(SELECT at.artist_id AS artist_id, at.name AS artist_name, SUM(il.unit_price*il.quantity) AS total_sales
FROM ((((customer c JOIN invoice i ON c.customer_id = i.customer_id)
JOIN invoice_line il ON i.invoice_id = il.invoice_id)
JOIN track t ON il.track_id = t.track_id)
JOIN album al ON t.album_id = al.album_id)
JOIN artist at ON al.artist_id = at.artist_id
GROUP BY at.artist_id
ORDER BY SUM(il.unit_price*il.quantity) DESC
LIMIT 1)
SELECT c.customer_id, c.first_name, c.last_name, bsa.artist_name, SUM(il.unit_price*il.quantity) AS amount_spent
FROM ((((customer c JOIN invoice i ON c.customer_id = i.customer_id)
JOIN invoice_line il ON i.invoice_id = il.invoice_id)
JOIN track t ON il.track_id = t.track_id)
JOIN album al ON t.album_id = al.album_id)
JOIN best_selling_artist bsa ON bsa.artist_id = al.artist_id
GROUP BY c.customer_id, c.first_name, c.last_name, bsa.artist_name
ORDER BY SUM(il.unit_price*il.quantity) DESC
